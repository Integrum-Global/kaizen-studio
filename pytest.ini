[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
asyncio_default_fixture_loop_scope = session
asyncio_default_test_loop_scope = session

# Markers for test tiers
markers =
    unit: Tier 1 unit tests (fast, isolated, mocking allowed)
    integration: Tier 2 integration tests (real infrastructure, NO MOCKING)
    e2e: Tier 3 end-to-end tests (complete workflows, NO MOCKING)

# Timeout settings
timeout = 10
timeout_method = thread

# Output settings
addopts = -v --tb=short

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # DataFlow bug: cache invalidation runs even when enable_caching=False
    # See studio/models/__init__.py - caching is disabled but DataFlow still
    # calls async cache methods synchronously, causing unawaited coroutine warnings
    ignore:coroutine 'AsyncRedisCacheAdapter.clear_pattern' was never awaited:RuntimeWarning
    ignore:coroutine 'AsyncRedisCacheAdapter.delete' was never awaited:RuntimeWarning
