# Frontend UI Design: External Integrations

**Document Version**: 1.0
**Last Updated**: 2025-12-20
**Status**: Draft
**Owner**: Kaizen Studio Frontend Team

---

## Table of Contents

1. [Overview](#overview)
2. [Technical Stack](#technical-stack)
3. [Pages Architecture](#pages-architecture)
4. [Component Library](#component-library)
5. [State Management](#state-management)
6. [API Integration](#api-integration)
7. [Accessibility Standards](#accessibility-standards)
8. [Responsive Design](#responsive-design)
9. [Implementation Roadmap](#implementation-roadmap)

---

## Overview

### Purpose

This document defines the frontend UI architecture for External Integrations in Kaizen Studio, covering:

- **External Agent Management**: Register, configure, and monitor external AI agents
- **Webhook Platform Configuration**: Multi-platform webhook integration (Teams, Discord, Telegram)
- **Invocation Lineage Viewer**: Visual tracing of agent invocation chains

### Design Principles

1. **Progressive Disclosure**: Show basic info first, details on demand
2. **Guided Workflows**: Wizards for complex registration processes
3. **Real-Time Feedback**: Live validation and connection testing
4. **Accessibility-First**: WCAG 2.1 AA compliance from day 1
5. **Responsive**: Mobile (375px), Tablet (768px), Desktop (1024px+)

---

## Technical Stack

### Core Technologies

```typescript
// Stack Overview
{
  "framework": "React 19",
  "language": "TypeScript 5.3+",
  "styling": "Tailwind CSS 3.4+",
  "components": "shadcn/ui",
  "state": {
    "global": "Zustand 4.x",
    "server": "@tanstack/react-query 5.x"
  },
  "routing": "React Router 6.x",
  "forms": "React Hook Form 7.x",
  "validation": "Zod"
}
```

### Design System

Follow Kaizen Studio design system:
- **Colors**: Primary (purple-600), Success (green-600), Danger (red-600)
- **Spacing**: 4px base unit (Tailwind default)
- **Typography**: Inter font family
- **Components**: shadcn/ui primitives

---

## Pages Architecture

### 1. External Agents Page

**Route**: `/settings/external-agents`

**Layout Structure**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ External Agents                    [+ Register Agent]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Search: [________________]  Filter: [Platform â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [Icon] Copilot Production Agent            â”‚    â”‚
â”‚  â”‚ Platform: GitHub Copilot  â€¢  Active        â”‚    â”‚
â”‚  â”‚ Endpoint: https://api.github.com/...       â”‚    â”‚
â”‚  â”‚ Invocations: 1,234  â€¢  Budget: $45/$100    â”‚    â”‚
â”‚  â”‚ [View Details] [Edit] [Disable]            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [Icon] Azure OpenAI Assistant              â”‚    â”‚
â”‚  â”‚ Platform: Azure OpenAI  â€¢  Active          â”‚    â”‚
â”‚  â”‚ Endpoint: https://eastus.api.cognitive.azure...â”‚
â”‚  â”‚ Invocations: 567  â€¢  Budget: $23/$50        â”‚    â”‚
â”‚  â”‚ [View Details] [Edit] [Disable]            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features**:
- Card-based agent list with key metrics
- Inline search and filter
- Quick actions (View, Edit, Disable)
- Empty state with "Register First Agent" CTA

---

### 2. External Agent Registration Wizard

**Route**: `/settings/external-agents/register`

**Modal/Page**: Full-page wizard with stepper

#### Wireframe: 6-Step Wizard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Register External Agent                         [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â‘  Basic Info â†’ â‘¡ Platform â†’ â‘¢ Auth â†’ â‘£ Governance â”‚
â”‚     â†’ â‘¤ Test â†’ â‘¥ Review                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                      â”‚
â”‚  Step 1: Basic Information                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                      â”‚
â”‚  Agent Name *                                        â”‚
â”‚  [____________________________________]              â”‚
â”‚                                                      â”‚
â”‚  Description                                         â”‚
â”‚  [____________________________________]              â”‚
â”‚  [____________________________________]              â”‚
â”‚  [____________________________________]              â”‚
â”‚                                                      â”‚
â”‚  Tags (optional)                                     â”‚
â”‚  [production] [gpt-4] [+ Add tag]                   â”‚
â”‚                                                      â”‚
â”‚                        [Cancel]  [Next: Platform â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step-by-Step Breakdown

**Step 1: Basic Info**
```typescript
interface BasicInfoStep {
  name: string;           // Required, 3-50 chars
  description: string;    // Optional, max 500 chars
  tags: string[];        // Optional
}
```

**Step 2: Platform Selection**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Platform Selection                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                      â”‚
â”‚  Select external agent platform:                    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [GitHub Icon]â”‚  â”‚ [Azure Icon] â”‚  â”‚ [API Icon]â”‚â”‚
â”‚  â”‚   GitHub     â”‚  â”‚    Azure     â”‚  â”‚  Custom   â”‚â”‚
â”‚  â”‚   Copilot    â”‚  â”‚   OpenAI     â”‚  â”‚   Agent   â”‚â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚           â”‚â”‚
â”‚  â”‚   [Select]   â”‚  â”‚   [Select]   â”‚  â”‚  [Select] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                      â”‚
â”‚  Platform-specific features will be configured      â”‚
â”‚  in the next step based on your selection.          â”‚
â”‚                                                      â”‚
â”‚                        [â† Back]  [Next: Auth â†’]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 3: Authentication Config**
```typescript
// GitHub Copilot
interface CopilotAuthConfig {
  endpoint_url: string;      // https://api.github.com/copilot/...
  api_key: string;           // GitHub token
  organization_id?: string;  // Optional
}

// Azure OpenAI
interface AzureOpenAIAuthConfig {
  endpoint_url: string;      // https://{resource}.openai.azure.com/
  api_key: string;           // Azure API key
  deployment_name: string;   // Deployment ID
  api_version: string;       // e.g., "2024-02-15-preview"
}

// Custom Agent
interface CustomAgentAuthConfig {
  endpoint_url: string;      // Full endpoint URL
  auth_type: "bearer" | "api_key" | "oauth2";
  credentials: Record<string, string>;  // Flexible auth
}
```

**Wireframe: Step 3 (GitHub Copilot Example)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Authentication Configuration               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                      â”‚
â”‚  Platform: GitHub Copilot                           â”‚
â”‚                                                      â”‚
â”‚  Endpoint URL *                                      â”‚
â”‚  [https://api.github.com/copilot/agents/___]        â”‚
â”‚  â„¹ï¸  Default endpoint for GitHub Copilot Extensions â”‚
â”‚                                                      â”‚
â”‚  API Key *                                           â”‚
â”‚  [ghp_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]  [Show]      â”‚
â”‚  âš ï¸  Store securely - never commit to version controlâ”‚
â”‚                                                      â”‚
â”‚  Organization ID (optional)                          â”‚
â”‚  [____________________________________]              â”‚
â”‚                                                      â”‚
â”‚  [Test Connection]                                   â”‚
â”‚  âœ… Connection successful! Detected GitHub Copilot v2â”‚
â”‚                                                      â”‚
â”‚                        [â† Back]  [Next: Governance â†’]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 4: Governance Config**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Governance Configuration                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                      â”‚
â”‚  Budget Limits                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Monthly Budget: $[____] USD                â”‚    â”‚
â”‚  â”‚ Alert Threshold: [80]%                     â”‚    â”‚
â”‚  â”‚ âœ‰ï¸  Send alerts to: admin@company.com      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Rate Limits                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Max Requests/Minute: [100]                 â”‚    â”‚
â”‚  â”‚ Max Requests/Hour: [1000]                  â”‚    â”‚
â”‚  â”‚ Max Requests/Day: [10000]                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Allowed Scopes (optional)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â˜‘ Read workspace data                      â”‚    â”‚
â”‚  â”‚ â˜‘ Execute workflows                        â”‚    â”‚
â”‚  â”‚ â˜ Modify agent configurations              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚                        [â† Back]  [Next: Test â†’]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 5: Test Connection**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: Test Connection                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                      â”‚
â”‚  Verify your configuration before registration.     â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Test Prompt                                â”‚    â”‚
â”‚  â”‚ [What is 2+2?__________________]           â”‚    â”‚
â”‚  â”‚                                 [Send Test]â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Results:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âœ… Connection: Successful                  â”‚    â”‚
â”‚  â”‚ âœ… Authentication: Valid                   â”‚    â”‚
â”‚  â”‚ âœ… Response Time: 342ms                    â”‚    â”‚
â”‚  â”‚                                             â”‚    â”‚
â”‚  â”‚ Agent Response:                             â”‚    â”‚
â”‚  â”‚ "2 + 2 equals 4."                          â”‚    â”‚
â”‚  â”‚                                             â”‚    â”‚
â”‚  â”‚ Metadata:                                   â”‚    â”‚
â”‚  â”‚ â€¢ Model: gpt-4-turbo                       â”‚    â”‚
â”‚  â”‚ â€¢ Tokens: 12 (input: 4, output: 8)         â”‚    â”‚
â”‚  â”‚ â€¢ Cost: $0.0003                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚                        [â† Back]  [Next: Review â†’]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 6: Review & Create**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: Review & Create                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                      â”‚
â”‚  Review your configuration:                         â”‚
â”‚                                                      â”‚
â”‚  Basic Information                      [Edit Step 1]â”‚
â”‚  â”œâ”€ Name: Copilot Production Agent                  â”‚
â”‚  â”œâ”€ Description: GitHub Copilot for production...   â”‚
â”‚  â””â”€ Tags: production, gpt-4                         â”‚
â”‚                                                      â”‚
â”‚  Platform                               [Edit Step 2]â”‚
â”‚  â””â”€ GitHub Copilot                                  â”‚
â”‚                                                      â”‚
â”‚  Authentication                         [Edit Step 3]â”‚
â”‚  â”œâ”€ Endpoint: https://api.github.com/copilot/...   â”‚
â”‚  â”œâ”€ API Key: ghp_â€¢â€¢â€¢â€¢ (stored securely)            â”‚
â”‚  â””â”€ Organization: acme-corp                         â”‚
â”‚                                                      â”‚
â”‚  Governance                             [Edit Step 4]â”‚
â”‚  â”œâ”€ Budget: $100/month (80% alert)                  â”‚
â”‚  â”œâ”€ Rate Limits: 100/min, 1000/hr, 10000/day       â”‚
â”‚  â””â”€ Scopes: Read workspace, Execute workflows       â”‚
â”‚                                                      â”‚
â”‚  â˜‘ I understand that this agent will have access    â”‚
â”‚     to the configured scopes and budgets.           â”‚
â”‚                                                      â”‚
â”‚                        [â† Back]  [Create Agent]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Agent Details Modal

**Trigger**: Click "View Details" from agent card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Copilot Production Agent                        [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Overviewâ”‚ Invocations â”‚ Metrics  â”‚ Settingsâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”â”â”â”â”â”â”â”â”                                          â”‚
â”‚                                                      â”‚
â”‚  Status: â— Active                                    â”‚
â”‚  Platform: GitHub Copilot                           â”‚
â”‚  Created: 2025-12-15 14:23 UTC                      â”‚
â”‚  Last Used: 2 minutes ago                           â”‚
â”‚                                                      â”‚
â”‚  Endpoint                                            â”‚
â”‚  https://api.github.com/copilot/agents/prod-v2      â”‚
â”‚                                                      â”‚
â”‚  Budget                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ $45.23 / $100.00                     â”‚          â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 45%     â”‚          â”‚
â”‚  â”‚ 15 days remaining                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                      â”‚
â”‚  Rate Limits                                         â”‚
â”‚  â€¢ Current: 23/100 requests/min                     â”‚
â”‚  â€¢ Peak today: 87/100 requests/min (11:34 UTC)     â”‚
â”‚                                                      â”‚
â”‚  Tags: production, gpt-4                            â”‚
â”‚                                                      â”‚
â”‚                    [Edit Agent]  [Disable Agent]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tab: Invocations**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Recent Invocations                                  â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2025-12-20 15:34:12 UTC                    â”‚    â”‚
â”‚  â”‚ Caller: pipeline-executor-prod             â”‚    â”‚
â”‚  â”‚ Prompt: "Generate test cases for..."       â”‚    â”‚
â”‚  â”‚ Tokens: 1,234  â€¢  Cost: $0.12  â€¢  342ms    â”‚    â”‚
â”‚  â”‚ [View Lineage] [View Full Details]         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2025-12-20 15:32:45 UTC                    â”‚    â”‚
â”‚  â”‚ Caller: user-alice@company.com             â”‚    â”‚
â”‚  â”‚ Prompt: "Explain this error message..."    â”‚    â”‚
â”‚  â”‚ Tokens: 567  â€¢  Cost: $0.05  â€¢  218ms      â”‚    â”‚
â”‚  â”‚ [View Lineage] [View Full Details]         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  [Load More]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tab: Metrics**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usage Metrics (Last 30 Days)                       â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        Invocations Over Time                â”‚    â”‚
â”‚  â”‚  200â”‚                     â•±â•²                â”‚    â”‚
â”‚  â”‚  150â”‚         â•±â•²    â•±â•²  â•±  â•²               â”‚    â”‚
â”‚  â”‚  100â”‚    â•±â•²  â•±  â•²  â•±  â•²â•±    â•²   â•±â•²         â”‚    â”‚
â”‚  â”‚   50â”‚   â•±  â•²â•±    â•²â•±         â•²â•±  â•²        â”‚    â”‚
â”‚  â”‚    0â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚
â”‚  â”‚     â”‚ Dec 1    Dec 10    Dec 20   Dec 30 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Cost Breakdown                              â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚    â”‚
â”‚  â”‚ â”‚ Input: $23   â”‚ 51%                       â”‚    â”‚
â”‚  â”‚ â”‚ Output: $22  â”‚ 49%                       â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Key Metrics:                                        â”‚
â”‚  â€¢ Total Invocations: 1,234                         â”‚
â”‚  â€¢ Success Rate: 98.7%                              â”‚
â”‚  â€¢ Avg Response Time: 287ms                         â”‚
â”‚  â€¢ Total Tokens: 456,789                            â”‚
â”‚  â€¢ Total Cost: $45.23                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Enhanced Webhooks Page

**Route**: `/settings/webhooks`

**Enhancement to existing page**: Add platform-specific configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webhook Integrations                  [+ Add Webhook]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Teams Icon] Microsoft Teams Alerts          â”‚   â”‚
â”‚  â”‚ Channel: #kaizen-alerts                      â”‚   â”‚
â”‚  â”‚ Events: deployment, error, budget            â”‚   â”‚
â”‚  â”‚ Last Sent: 2 minutes ago (âœ… Success)        â”‚   â”‚
â”‚  â”‚ [Test] [Edit] [Delete]                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Discord Icon] Discord Bot Notifications     â”‚   â”‚
â”‚  â”‚ Channel: #bot-alerts                         â”‚   â”‚
â”‚  â”‚ Events: agent_invocation, error              â”‚   â”‚
â”‚  â”‚ Last Sent: 15 minutes ago (âœ… Success)       â”‚   â”‚
â”‚  â”‚ [Test] [Edit] [Delete]                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Add/Edit Webhook Modal**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Webhook Integration                         [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Platform *                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Microsoft Teams                       â–¼  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                      â”‚
â”‚  â”€â”€â”€ Microsoft Teams Configuration â”€â”€â”€              â”‚
â”‚                                                      â”‚
â”‚  Webhook URL *                                       â”‚
â”‚  [https://outlook.office.com/webhook/______]        â”‚
â”‚  â„¹ï¸  Get this from Teams channel connector settings â”‚
â”‚                                                      â”‚
â”‚  Message Template                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Adaptive Card                         â–¼  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                      â”‚
â”‚  Card Color (Theme)                                  â”‚
â”‚  [Attention] â–¼  (Red for errors, Blue for info)    â”‚
â”‚                                                      â”‚
â”‚  Events to Send                                      â”‚
â”‚  â˜‘ Agent Invocations                                â”‚
â”‚  â˜‘ Deployment Events                                â”‚
â”‚  â˜‘ Budget Alerts                                     â”‚
â”‚  â˜‘ Error Notifications                              â”‚
â”‚  â˜ Audit Events                                      â”‚
â”‚                                                      â”‚
â”‚  Preview:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ¤– Kaizen Studio Alert                   â”‚      â”‚
â”‚  â”‚ External Agent Invoked                   â”‚      â”‚
â”‚  â”‚ â€¢ Agent: Copilot Production              â”‚      â”‚
â”‚  â”‚ â€¢ Cost: $0.12                            â”‚      â”‚
â”‚  â”‚ â€¢ Time: 2025-12-20 15:34 UTC             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                      â”‚
â”‚  [Test Webhook]                                      â”‚
â”‚  âœ… Test message sent successfully!                 â”‚
â”‚                                                      â”‚
â”‚                         [Cancel]  [Save Webhook]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Platform-Specific Fields**:

```typescript
// Microsoft Teams
interface TeamsWebhookConfig {
  webhook_url: string;
  message_template: "adaptive_card" | "simple_text";
  card_theme_color: "default" | "good" | "warning" | "attention";
}

// Discord
interface DiscordWebhookConfig {
  webhook_url: string;
  username?: string;          // Bot display name
  avatar_url?: string;        // Bot avatar
  embed_color: string;        // Hex color code
  use_embeds: boolean;        // Rich embeds vs plain text
}

// Telegram
interface TelegramWebhookConfig {
  bot_token: string;
  chat_id: string;
  parse_mode: "Markdown" | "HTML" | "MarkdownV2";
  disable_notification?: boolean;
}
```

---

### 5. Invocation Lineage Viewer

**Route**: `/audit/lineage/{invocation_id}`

**Full-Page View with Timeline**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Invocation Lineage: inv_abc123xyz                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Timeline                          [Export JSON]    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                      â”‚
â”‚  â‘  15:34:12.345                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Initial Request                          â”‚    â”‚
â”‚     â”‚ Caller: pipeline-executor-prod           â”‚    â”‚
â”‚     â”‚ Identity: service:prod:pipeline-exec     â”‚    â”‚
â”‚     â”‚ Workspace: ws_prod_001                   â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                â”‚
â”‚     â–¼                                                â”‚
â”‚  â‘¡ 15:34:12.456                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Kaizen Agent Processing                  â”‚    â”‚
â”‚     â”‚ Agent: CodeReviewAgent                   â”‚    â”‚
â”‚     â”‚ Identity: agent:kaizen:code-review       â”‚    â”‚
â”‚     â”‚ Decision: Delegate to External Agent     â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                â”‚
â”‚     â–¼                                                â”‚
â”‚  â‘¢ 15:34:12.678                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ External Agent Invoked                   â”‚    â”‚
â”‚     â”‚ Agent: Copilot Production Agent          â”‚    â”‚
â”‚     â”‚ Identity: external:github-copilot:prod   â”‚    â”‚
â”‚     â”‚ Endpoint: https://api.github.com/...     â”‚    â”‚
â”‚     â”‚ Tokens: 1,234  â€¢  Cost: $0.12            â”‚    â”‚
â”‚     â”‚ Response Time: 342ms                     â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â”‚                                                â”‚
â”‚     â–¼                                                â”‚
â”‚  â‘£ 15:34:13.020                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Response Returned                        â”‚    â”‚
â”‚     â”‚ To: pipeline-executor-prod               â”‚    â”‚
â”‚     â”‚ Status: Success (200)                    â”‚    â”‚
â”‚     â”‚ Total Duration: 675ms                    â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                      â”‚
â”‚  Context Details                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Session ID: sess_prod_xyz789                â”‚    â”‚
â”‚  â”‚ Workspace: ws_prod_001                      â”‚    â”‚
â”‚  â”‚ User: alice@company.com                     â”‚    â”‚
â”‚  â”‚ IP Address: 192.168.1.100                   â”‚    â”‚
â”‚  â”‚ User Agent: Kaizen-Studio/1.0               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  Identity Chain                                      â”‚
â”‚  service:prod:pipeline-exec                         â”‚
â”‚    â†’ agent:kaizen:code-review                       â”‚
â”‚      â†’ external:github-copilot:prod                 â”‚
â”‚                                                      â”‚
â”‚  Governance Checks                                   â”‚
â”‚  âœ… Budget limit: $0.12 / $100.00 (0.12%)           â”‚
â”‚  âœ… Rate limit: 24/100 requests/min                 â”‚
â”‚  âœ… Scope allowed: execute_workflows                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Expandable Detail Panels**:

Click on any hop to expand full details:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¢ External Agent Invoked (Expanded)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Agent: Copilot Production Agent              â”‚  â”‚
â”‚  â”‚ Identity: external:github-copilot:prod       â”‚  â”‚
â”‚  â”‚ Timestamp: 2025-12-20T15:34:12.678Z          â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚ Request:                                      â”‚  â”‚
â”‚  â”‚ {                                             â”‚  â”‚
â”‚  â”‚   "prompt": "Generate test cases for...",    â”‚  â”‚
â”‚  â”‚   "context": {...},                          â”‚  â”‚
â”‚  â”‚   "max_tokens": 2000                         â”‚  â”‚
â”‚  â”‚ }                                             â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚ Response:                                     â”‚  â”‚
â”‚  â”‚ {                                             â”‚  â”‚
â”‚  â”‚   "content": "Here are comprehensive test...",â”‚  â”‚
â”‚  â”‚   "tokens_used": 1234,                       â”‚  â”‚
â”‚  â”‚   "model": "gpt-4-turbo"                     â”‚  â”‚
â”‚  â”‚ }                                             â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚ Metrics:                                      â”‚  â”‚
â”‚  â”‚ â€¢ Input Tokens: 456                          â”‚  â”‚
â”‚  â”‚ â€¢ Output Tokens: 778                         â”‚  â”‚
â”‚  â”‚ â€¢ Cost: $0.12                                â”‚  â”‚
â”‚  â”‚ â€¢ Latency: 342ms                             â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚ [Copy Request] [Copy Response] [View Raw]    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Library

### Directory Structure

```
apps/kaizen-studio/apps/frontend/src/features/external-agents/
â”œâ”€â”€ index.tsx                    # Feature entry point
â”œâ”€â”€ elements/
â”‚   â”œâ”€â”€ ExternalAgentList.tsx    # Main list view
â”‚   â”œâ”€â”€ ExternalAgentCard.tsx    # Individual agent card
â”‚   â”œâ”€â”€ ExternalAgentWizard.tsx  # Registration wizard
â”‚   â”œâ”€â”€ AgentDetailsModal.tsx    # Details modal with tabs
â”‚   â”œâ”€â”€ InvocationHistory.tsx    # Invocation list
â”‚   â”œâ”€â”€ UsageMetricsChart.tsx    # Charts for metrics
â”‚   â”œâ”€â”€ LineageViewer.tsx        # Timeline visualization
â”‚   â”œâ”€â”€ LineageHop.tsx           # Single hop in timeline
â”‚   â”œâ”€â”€ WebhookConfigForm.tsx    # Platform-specific webhook forms
â”‚   â”œâ”€â”€ PlatformSelector.tsx     # Platform picker
â”‚   â””â”€â”€ TestConnectionButton.tsx # Connection tester
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ externalAgents.ts        # API client functions
â”‚   â”œâ”€â”€ invocations.ts           # Invocation API
â”‚   â””â”€â”€ webhooks.ts              # Webhook API
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useExternalAgents.ts     # React Query hooks
â”‚   â”œâ”€â”€ useInvocations.ts
â”‚   â””â”€â”€ useLineage.ts
â”œâ”€â”€ store/
â”‚   â””â”€â”€ externalAgentsStore.ts   # Zustand store
â””â”€â”€ types/
    â”œâ”€â”€ externalAgent.ts         # TypeScript types
    â”œâ”€â”€ invocation.ts
    â””â”€â”€ webhook.ts
```

### Key Components

#### 1. ExternalAgentList.tsx

```typescript
import { useQuery } from "@tanstack/react-query";
import { ExternalAgentCard } from "./ExternalAgentCard";
import { Skeleton } from "@/components/ui/skeleton";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

export function ExternalAgentList() {
  const { isPending, error, data } = useQuery({
    queryKey: ["external-agents"],
    queryFn: () => fetch("/api/external-agents").then((res) => res.json()),
  });

  const [searchTerm, setSearchTerm] = useState("");
  const [platformFilter, setPlatformFilter] = useState<string | null>(null);

  if (isPending) return <ExternalAgentListSkeleton />;
  if (error) return <ErrorMessage error={error} />;

  const filteredAgents = data.agents.filter((agent) => {
    const matchesSearch = agent.name
      .toLowerCase()
      .includes(searchTerm.toLowerCase());
    const matchesPlatform =
      !platformFilter || agent.platform === platformFilter;
    return matchesSearch && matchesPlatform;
  });

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h1 className="text-3xl font-bold">External Agents</h1>
        <Button onClick={() => navigate("/settings/external-agents/register")}>
          + Register Agent
        </Button>
      </div>

      <div className="flex gap-4">
        <Input
          placeholder="Search agents..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="flex-1"
        />
        <Select value={platformFilter} onValueChange={setPlatformFilter}>
          <SelectTrigger className="w-[200px]">
            <SelectValue placeholder="All Platforms" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value={null}>All Platforms</SelectItem>
            <SelectItem value="copilot">GitHub Copilot</SelectItem>
            <SelectItem value="azure_openai">Azure OpenAI</SelectItem>
            <SelectItem value="custom">Custom Agent</SelectItem>
          </SelectContent>
        </Select>
      </div>

      <div className="grid gap-4">
        {filteredAgents.length === 0 ? (
          <EmptyState
            title="No agents found"
            description="Try adjusting your search or filters"
          />
        ) : (
          filteredAgents.map((agent) => (
            <ExternalAgentCard key={agent.id} agent={agent} />
          ))
        )}
      </div>
    </div>
  );
}

function ExternalAgentListSkeleton() {
  return (
    <div className="grid gap-4">
      {[...Array(5)].map((_, i) => (
        <div key={i} className="flex gap-4 items-center">
          <Skeleton className="h-12 w-12 rounded-full" />
          <div className="space-y-2 flex-1">
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-2/3" />
          </div>
        </div>
      ))}
    </div>
  );
}
```

#### 2. ExternalAgentCard.tsx

```typescript
import { Card, CardHeader, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ExternalAgent } from "../types/externalAgent";

interface ExternalAgentCardProps {
  agent: ExternalAgent;
}

export function ExternalAgentCard({ agent }: ExternalAgentCardProps) {
  const budgetPercentage = (agent.usage.cost / agent.budget.monthly_limit) * 100;

  return (
    <Card>
      <CardHeader>
        <div className="flex items-start justify-between">
          <div className="flex items-center gap-3">
            <div className="h-12 w-12 rounded-full bg-purple-100 flex items-center justify-center">
              {agent.platform === "copilot" && "ğŸ¤–"}
              {agent.platform === "azure_openai" && "â˜ï¸"}
              {agent.platform === "custom" && "âš™ï¸"}
            </div>
            <div>
              <h3 className="text-lg font-semibold">{agent.name}</h3>
              <div className="flex items-center gap-2 text-sm text-gray-500">
                <span>{getPlatformLabel(agent.platform)}</span>
                <span>â€¢</span>
                <Badge
                  variant={agent.status === "active" ? "success" : "secondary"}
                >
                  {agent.status}
                </Badge>
              </div>
            </div>
          </div>
          <div className="flex gap-2">
            <Button variant="outline" size="sm" onClick={() => viewDetails(agent.id)}>
              View Details
            </Button>
            <Button variant="outline" size="sm" onClick={() => editAgent(agent.id)}>
              Edit
            </Button>
            <Button
              variant="destructive"
              size="sm"
              onClick={() => disableAgent(agent.id)}
            >
              Disable
            </Button>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          <div className="text-sm">
            <span className="text-gray-500">Endpoint:</span>
            <span className="ml-2 font-mono text-xs">{agent.endpoint_url}</span>
          </div>

          <div className="flex items-center gap-4 text-sm">
            <span>
              <span className="text-gray-500">Invocations:</span>
              <span className="ml-2 font-semibold">
                {agent.usage.total_invocations.toLocaleString()}
              </span>
            </span>
            <span>â€¢</span>
            <span>
              <span className="text-gray-500">Budget:</span>
              <span className="ml-2 font-semibold">
                ${agent.usage.cost.toFixed(2)} / ${agent.budget.monthly_limit}
              </span>
            </span>
          </div>

          <div className="w-full bg-gray-200 rounded-full h-2">
            <div
              className={`h-2 rounded-full ${
                budgetPercentage > 80
                  ? "bg-red-500"
                  : budgetPercentage > 50
                  ? "bg-yellow-500"
                  : "bg-green-500"
              }`}
              style={{ width: `${Math.min(budgetPercentage, 100)}%` }}
            />
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

function getPlatformLabel(platform: string): string {
  const labels = {
    copilot: "GitHub Copilot",
    azure_openai: "Azure OpenAI",
    custom: "Custom Agent",
  };
  return labels[platform] || platform;
}
```

#### 3. ExternalAgentWizard.tsx

```typescript
import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { useMutation } from "@tanstack/react-query";
import { Stepper } from "@/components/ui/stepper";
import { Button } from "@/components/ui/button";
import { Form } from "@/components/ui/form";

const basicInfoSchema = z.object({
  name: z.string().min(3).max(50),
  description: z.string().max(500).optional(),
  tags: z.array(z.string()).optional(),
});

const platformSchema = z.object({
  platform: z.enum(["copilot", "azure_openai", "custom"]),
});

const authConfigSchema = z.object({
  endpoint_url: z.string().url(),
  api_key: z.string().min(1),
  // Platform-specific fields added dynamically
});

type WizardStep = 1 | 2 | 3 | 4 | 5 | 6;

export function ExternalAgentWizard() {
  const [currentStep, setCurrentStep] = useState<WizardStep>(1);
  const [wizardData, setWizardData] = useState({});

  const { mutate: createAgent, isPending } = useMutation({
    mutationFn: (data: ExternalAgentCreate) =>
      fetch("/api/external-agents", {
        method: "POST",
        body: JSON.stringify(data),
      }).then((res) => res.json()),
    onSuccess: () => {
      toast.success("Agent registered successfully!");
      navigate("/settings/external-agents");
    },
  });

  const nextStep = (data: any) => {
    setWizardData({ ...wizardData, ...data });
    setCurrentStep((prev) => Math.min(prev + 1, 6) as WizardStep);
  };

  const prevStep = () => {
    setCurrentStep((prev) => Math.max(prev - 1, 1) as WizardStep);
  };

  return (
    <div className="max-w-3xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Register External Agent</h1>

      <Stepper
        steps={[
          { label: "Basic Info", number: 1 },
          { label: "Platform", number: 2 },
          { label: "Authentication", number: 3 },
          { label: "Governance", number: 4 },
          { label: "Test", number: 5 },
          { label: "Review", number: 6 },
        ]}
        currentStep={currentStep}
      />

      <div className="mt-8">
        {currentStep === 1 && (
          <BasicInfoStep onNext={nextStep} initialData={wizardData} />
        )}
        {currentStep === 2 && (
          <PlatformSelectionStep
            onNext={nextStep}
            onBack={prevStep}
            initialData={wizardData}
          />
        )}
        {currentStep === 3 && (
          <AuthConfigStep
            onNext={nextStep}
            onBack={prevStep}
            platform={wizardData.platform}
            initialData={wizardData}
          />
        )}
        {currentStep === 4 && (
          <GovernanceConfigStep
            onNext={nextStep}
            onBack={prevStep}
            initialData={wizardData}
          />
        )}
        {currentStep === 5 && (
          <TestConnectionStep
            onNext={nextStep}
            onBack={prevStep}
            config={wizardData}
          />
        )}
        {currentStep === 6 && (
          <ReviewStep
            onBack={prevStep}
            onSubmit={(data) => createAgent(data)}
            data={wizardData}
            isPending={isPending}
          />
        )}
      </div>
    </div>
  );
}

// Individual step components
function BasicInfoStep({ onNext, initialData }) {
  const form = useForm({
    resolver: zodResolver(basicInfoSchema),
    defaultValues: initialData,
  });

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onNext)} className="space-y-4">
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Agent Name *</FormLabel>
              <FormControl>
                <Input placeholder="Production Copilot Agent" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="description"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Description</FormLabel>
              <FormControl>
                <Textarea
                  placeholder="GitHub Copilot integration for production workflows..."
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="flex justify-end">
          <Button type="submit">Next: Platform â†’</Button>
        </div>
      </form>
    </Form>
  );
}
```

#### 4. LineageViewer.tsx

```typescript
import { useQuery } from "@tanstack/react-query";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { LineageHop } from "./LineageHop";

interface LineageViewerProps {
  invocationId: string;
}

export function LineageViewer({ invocationId }: LineageViewerProps) {
  const { isPending, error, data } = useQuery({
    queryKey: ["lineage", invocationId],
    queryFn: () =>
      fetch(`/api/invocations/${invocationId}/lineage`).then((res) => res.json()),
  });

  if (isPending) return <LineageSkeleton />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <div className="max-w-4xl mx-auto p-6 space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-3xl font-bold">Invocation Lineage</h1>
        <Button variant="outline" onClick={() => exportLineage(data)}>
          Export JSON
        </Button>
      </div>

      {/* Timeline */}
      <div className="space-y-4">
        <h2 className="text-xl font-semibold">Timeline</h2>
        <div className="relative">
          {/* Vertical line connecting hops */}
          <div className="absolute left-6 top-0 bottom-0 w-0.5 bg-gray-300" />

          {data.hops.map((hop, index) => (
            <LineageHop
              key={hop.id}
              hop={hop}
              hopNumber={index + 1}
              isLast={index === data.hops.length - 1}
            />
          ))}
        </div>
      </div>

      {/* Context Details */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4">Context Details</h2>
        <dl className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <dt className="text-gray-500">Session ID</dt>
            <dd className="font-mono">{data.context.session_id}</dd>
          </div>
          <div>
            <dt className="text-gray-500">Workspace</dt>
            <dd className="font-mono">{data.context.workspace_id}</dd>
          </div>
          <div>
            <dt className="text-gray-500">User</dt>
            <dd>{data.context.user_email}</dd>
          </div>
          <div>
            <dt className="text-gray-500">IP Address</dt>
            <dd className="font-mono">{data.context.ip_address}</dd>
          </div>
        </dl>
      </Card>

      {/* Identity Chain */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4">Identity Chain</h2>
        <div className="flex items-center gap-2 text-sm font-mono">
          {data.identity_chain.map((identity, index) => (
            <div key={index} className="flex items-center gap-2">
              <Badge variant="outline">{identity}</Badge>
              {index < data.identity_chain.length - 1 && (
                <span className="text-gray-400">â†’</span>
              )}
            </div>
          ))}
        </div>
      </Card>

      {/* Governance Checks */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4">Governance Checks</h2>
        <div className="space-y-2">
          <div className="flex items-center gap-2">
            <span className="text-green-600">âœ…</span>
            <span className="text-sm">
              Budget limit: ${data.governance.cost} / $
              {data.governance.budget_limit} ({data.governance.budget_percentage}%)
            </span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-green-600">âœ…</span>
            <span className="text-sm">
              Rate limit: {data.governance.rate_limit_current}/
              {data.governance.rate_limit_max} requests/min
            </span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-green-600">âœ…</span>
            <span className="text-sm">
              Scope allowed: {data.governance.scope_used}
            </span>
          </div>
        </div>
      </Card>
    </div>
  );
}

function LineageSkeleton() {
  return (
    <div className="max-w-4xl mx-auto p-6 space-y-6">
      <Skeleton className="h-8 w-64" />
      <div className="space-y-4">
        {[...Array(4)].map((_, i) => (
          <Skeleton key={i} className="h-32 w-full" />
        ))}
      </div>
    </div>
  );
}
```

#### 5. LineageHop.tsx

```typescript
import { useState } from "react";
import { Card, CardHeader, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ChevronDown, ChevronUp } from "lucide-react";

interface LineageHopProps {
  hop: LineageHop;
  hopNumber: number;
  isLast: boolean;
}

export function LineageHop({ hop, hopNumber, isLast }: LineageHopProps) {
  const [isExpanded, setIsExpanded] = useState(false);

  return (
    <div className="relative pl-16 pb-8">
      {/* Hop number badge */}
      <div className="absolute left-0 top-0 w-12 h-12 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold">
        {hopNumber}
      </div>

      <Card>
        <CardHeader>
          <div className="flex justify-between items-start">
            <div>
              <h3 className="text-lg font-semibold">{hop.title}</h3>
              <p className="text-sm text-gray-500">{formatTimestamp(hop.timestamp)}</p>
            </div>
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setIsExpanded(!isExpanded)}
            >
              {isExpanded ? <ChevronUp /> : <ChevronDown />}
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          <dl className="grid grid-cols-2 gap-2 text-sm">
            <div>
              <dt className="text-gray-500">Caller</dt>
              <dd className="font-mono">{hop.caller}</dd>
            </div>
            <div>
              <dt className="text-gray-500">Identity</dt>
              <dd className="font-mono">{hop.identity}</dd>
            </div>
            {hop.agent_name && (
              <div>
                <dt className="text-gray-500">Agent</dt>
                <dd>{hop.agent_name}</dd>
              </div>
            )}
            {hop.cost && (
              <div>
                <dt className="text-gray-500">Cost</dt>
                <dd>${hop.cost.toFixed(4)}</dd>
              </div>
            )}
          </dl>

          {isExpanded && (
            <div className="mt-4 space-y-4 border-t pt-4">
              {hop.request && (
                <div>
                  <h4 className="font-semibold mb-2">Request</h4>
                  <pre className="bg-gray-100 p-3 rounded text-xs overflow-x-auto">
                    {JSON.stringify(hop.request, null, 2)}
                  </pre>
                </div>
              )}
              {hop.response && (
                <div>
                  <h4 className="font-semibold mb-2">Response</h4>
                  <pre className="bg-gray-100 p-3 rounded text-xs overflow-x-auto">
                    {JSON.stringify(hop.response, null, 2)}
                  </pre>
                </div>
              )}
              {hop.metrics && (
                <div>
                  <h4 className="font-semibold mb-2">Metrics</h4>
                  <dl className="grid grid-cols-2 gap-2 text-sm">
                    <div>
                      <dt className="text-gray-500">Input Tokens</dt>
                      <dd>{hop.metrics.input_tokens}</dd>
                    </div>
                    <div>
                      <dt className="text-gray-500">Output Tokens</dt>
                      <dd>{hop.metrics.output_tokens}</dd>
                    </div>
                    <div>
                      <dt className="text-gray-500">Latency</dt>
                      <dd>{hop.metrics.latency_ms}ms</dd>
                    </div>
                    <div>
                      <dt className="text-gray-500">Cost</dt>
                      <dd>${hop.metrics.cost.toFixed(4)}</dd>
                    </div>
                  </dl>
                </div>
              )}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Arrow to next hop */}
      {!isLast && (
        <div className="absolute left-6 -bottom-4 text-gray-400">â–¼</div>
      )}
    </div>
  );
}

function formatTimestamp(timestamp: string): string {
  return new Date(timestamp).toLocaleString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    fractionalSecondDigits: 3,
  });
}
```

#### 6. UsageMetricsChart.tsx

```typescript
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  PieChart,
  Pie,
  Cell,
} from "recharts";
import { Card, CardHeader, CardContent } from "@/components/ui/card";

interface UsageMetricsChartProps {
  agentId: string;
  timeRange: "7d" | "30d" | "90d";
}

export function UsageMetricsChart({
  agentId,
  timeRange,
}: UsageMetricsChartProps) {
  const { data } = useQuery({
    queryKey: ["agent-metrics", agentId, timeRange],
    queryFn: () =>
      fetch(`/api/external-agents/${agentId}/metrics?range=${timeRange}`).then(
        (res) => res.json()
      ),
  });

  if (!data) return null;

  return (
    <div className="space-y-6">
      {/* Invocations Over Time */}
      <Card>
        <CardHeader>
          <h3 className="text-lg font-semibold">Invocations Over Time</h3>
        </CardHeader>
        <CardContent>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={data.timeseries}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis
                dataKey="date"
                tickFormatter={(date) =>
                  new Date(date).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                  })
                }
              />
              <YAxis />
              <Tooltip />
              <Line
                type="monotone"
                dataKey="invocations"
                stroke="#8b5cf6"
                strokeWidth={2}
              />
            </LineChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>

      {/* Cost Breakdown */}
      <Card>
        <CardHeader>
          <h3 className="text-lg font-semibold">Cost Breakdown</h3>
        </CardHeader>
        <CardContent>
          <ResponsiveContainer width="100%" height={300}>
            <PieChart>
              <Pie
                data={[
                  { name: "Input Tokens", value: data.cost_breakdown.input },
                  { name: "Output Tokens", value: data.cost_breakdown.output },
                ]}
                cx="50%"
                cy="50%"
                labelLine={false}
                label={({ name, percent }) =>
                  `${name}: ${(percent * 100).toFixed(0)}%`
                }
                outerRadius={80}
                fill="#8884d8"
                dataKey="value"
              >
                <Cell fill="#8b5cf6" />
                <Cell fill="#a78bfa" />
              </Pie>
              <Tooltip />
            </PieChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>

      {/* Key Metrics Summary */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <MetricCard
          label="Total Invocations"
          value={data.summary.total_invocations.toLocaleString()}
        />
        <MetricCard
          label="Success Rate"
          value={`${data.summary.success_rate.toFixed(1)}%`}
        />
        <MetricCard
          label="Avg Response Time"
          value={`${data.summary.avg_response_time}ms`}
        />
        <MetricCard
          label="Total Cost"
          value={`$${data.summary.total_cost.toFixed(2)}`}
        />
      </div>
    </div>
  );
}

function MetricCard({ label, value }) {
  return (
    <Card>
      <CardContent className="p-4">
        <p className="text-sm text-gray-500">{label}</p>
        <p className="text-2xl font-bold mt-1">{value}</p>
      </CardContent>
    </Card>
  );
}
```

---

## State Management

### Zustand Store

```typescript
// src/features/external-agents/store/externalAgentsStore.ts

import { create } from "zustand";
import { ExternalAgent, ExternalAgentFilters } from "../types/externalAgent";

interface ExternalAgentsStore {
  // State
  selectedAgent: ExternalAgent | null;
  filters: ExternalAgentFilters;
  wizardData: Partial<ExternalAgentCreate>;
  wizardStep: number;

  // Actions
  setSelectedAgent: (agent: ExternalAgent | null) => void;
  setFilters: (filters: Partial<ExternalAgentFilters>) => void;
  updateWizardData: (data: Partial<ExternalAgentCreate>) => void;
  setWizardStep: (step: number) => void;
  resetWizard: () => void;
}

export const useExternalAgentsStore = create<ExternalAgentsStore>((set) => ({
  // Initial state
  selectedAgent: null,
  filters: {
    search: "",
    platform: null,
    status: "active",
  },
  wizardData: {},
  wizardStep: 1,

  // Actions
  setSelectedAgent: (agent) => set({ selectedAgent: agent }),

  setFilters: (filters) =>
    set((state) => ({ filters: { ...state.filters, ...filters } })),

  updateWizardData: (data) =>
    set((state) => ({ wizardData: { ...state.wizardData, ...data } })),

  setWizardStep: (step) => set({ wizardStep: step }),

  resetWizard: () => set({ wizardData: {}, wizardStep: 1 }),
}));
```

### React Query Hooks

```typescript
// src/features/external-agents/hooks/useExternalAgents.ts

import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import * as api from "../api/externalAgents";

export function useExternalAgents(filters?: ExternalAgentFilters) {
  return useQuery({
    queryKey: ["external-agents", filters],
    queryFn: () => api.getExternalAgents(filters),
  });
}

export function useExternalAgent(agentId: string) {
  return useQuery({
    queryKey: ["external-agent", agentId],
    queryFn: () => api.getExternalAgent(agentId),
    enabled: !!agentId,
  });
}

export function useCreateExternalAgent() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: api.createExternalAgent,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["external-agents"] });
      toast.success("External agent registered successfully!");
    },
    onError: (error) => {
      toast.error(`Failed to register agent: ${error.message}`);
    },
  });
}

export function useUpdateExternalAgent() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: ExternalAgentUpdate }) =>
      api.updateExternalAgent(id, data),
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ["external-agent", id] });
      queryClient.invalidateQueries({ queryKey: ["external-agents"] });
      toast.success("External agent updated successfully!");
    },
  });
}

export function useDeleteExternalAgent() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: api.deleteExternalAgent,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["external-agents"] });
      toast.success("External agent deleted successfully!");
    },
  });
}

export function useTestConnection() {
  return useMutation({
    mutationFn: api.testConnection,
    onSuccess: (data) => {
      if (data.success) {
        toast.success("Connection test successful!");
      } else {
        toast.error(`Connection test failed: ${data.error}`);
      }
    },
  });
}
```

```typescript
// src/features/external-agents/hooks/useInvocations.ts

import { useQuery } from "@tanstack/react-query";
import * as api from "../api/invocations";

export function useInvocations(agentId: string, filters?: InvocationFilters) {
  return useQuery({
    queryKey: ["invocations", agentId, filters],
    queryFn: () => api.getInvocations(agentId, filters),
    enabled: !!agentId,
  });
}

export function useInvocationLineage(invocationId: string) {
  return useQuery({
    queryKey: ["lineage", invocationId],
    queryFn: () => api.getInvocationLineage(invocationId),
    enabled: !!invocationId,
  });
}

export function useAgentMetrics(agentId: string, timeRange: string) {
  return useQuery({
    queryKey: ["agent-metrics", agentId, timeRange],
    queryFn: () => api.getAgentMetrics(agentId, timeRange),
    enabled: !!agentId,
  });
}
```

---

## API Integration

### API Client

```typescript
// src/features/external-agents/api/externalAgents.ts

import { apiClient } from "@/api";
import {
  ExternalAgent,
  ExternalAgentCreate,
  ExternalAgentUpdate,
  ExternalAgentFilters,
} from "../types/externalAgent";

export async function getExternalAgents(
  filters?: ExternalAgentFilters
): Promise<ExternalAgent[]> {
  const params = new URLSearchParams();
  if (filters?.search) params.set("search", filters.search);
  if (filters?.platform) params.set("platform", filters.platform);
  if (filters?.status) params.set("status", filters.status);

  const response = await apiClient.get(`/external-agents?${params}`);
  return response.data.agents;
}

export async function getExternalAgent(id: string): Promise<ExternalAgent> {
  const response = await apiClient.get(`/external-agents/${id}`);
  return response.data;
}

export async function createExternalAgent(
  data: ExternalAgentCreate
): Promise<ExternalAgent> {
  const response = await apiClient.post("/external-agents", data);
  return response.data;
}

export async function updateExternalAgent(
  id: string,
  data: ExternalAgentUpdate
): Promise<ExternalAgent> {
  const response = await apiClient.put(`/external-agents/${id}`, data);
  return response.data;
}

export async function deleteExternalAgent(id: string): Promise<void> {
  await apiClient.delete(`/external-agents/${id}`);
}

export async function testConnection(
  config: ExternalAgentAuthConfig
): Promise<{ success: boolean; error?: string; metadata?: any }> {
  const response = await apiClient.post("/external-agents/test", config);
  return response.data;
}
```

```typescript
// src/features/external-agents/api/invocations.ts

import { apiClient } from "@/api";
import { Invocation, InvocationLineage } from "../types/invocation";

export async function getInvocations(
  agentId: string,
  filters?: InvocationFilters
): Promise<Invocation[]> {
  const params = new URLSearchParams();
  if (filters?.start_date) params.set("start_date", filters.start_date);
  if (filters?.end_date) params.set("end_date", filters.end_date);
  if (filters?.status) params.set("status", filters.status);

  const response = await apiClient.get(
    `/external-agents/${agentId}/invocations?${params}`
  );
  return response.data.invocations;
}

export async function getInvocationLineage(
  invocationId: string
): Promise<InvocationLineage> {
  const response = await apiClient.get(`/invocations/${invocationId}/lineage`);
  return response.data;
}

export async function getAgentMetrics(
  agentId: string,
  timeRange: string
): Promise<AgentMetrics> {
  const response = await apiClient.get(
    `/external-agents/${agentId}/metrics?range=${timeRange}`
  );
  return response.data;
}
```

---

## Accessibility Standards

### WCAG 2.1 AA Compliance

#### Keyboard Navigation

```typescript
// Ensure all interactive elements are keyboard accessible
function ExternalAgentCard({ agent }) {
  return (
    <Card tabIndex={0} onKeyDown={handleKeyDown}>
      {/* ... */}
      <Button
        onClick={viewDetails}
        aria-label={`View details for ${agent.name}`}
      >
        View Details
      </Button>
    </Card>
  );
}

function handleKeyDown(e: KeyboardEvent) {
  if (e.key === "Enter" || e.key === " ") {
    e.preventDefault();
    viewDetails();
  }
}
```

#### ARIA Labels

```typescript
// Wizard stepper
<div role="navigation" aria-label="Agent registration wizard">
  <ol className="flex items-center gap-4">
    {steps.map((step, index) => (
      <li
        key={step.number}
        aria-current={currentStep === step.number ? "step" : undefined}
        aria-label={`Step ${step.number}: ${step.label}${
          currentStep === step.number ? " (current)" : ""
        }`}
      >
        <StepIndicator {...step} />
      </li>
    ))}
  </ol>
</div>

// Form fields
<FormField
  control={form.control}
  name="api_key"
  render={({ field }) => (
    <FormItem>
      <FormLabel htmlFor="api_key">API Key *</FormLabel>
      <FormControl>
        <Input
          id="api_key"
          type="password"
          aria-required="true"
          aria-invalid={!!errors.api_key}
          aria-describedby="api_key_error api_key_help"
          {...field}
        />
      </FormControl>
      <FormDescription id="api_key_help">
        Store securely - never commit to version control
      </FormDescription>
      {errors.api_key && (
        <FormMessage id="api_key_error" role="alert">
          {errors.api_key.message}
        </FormMessage>
      )}
    </FormItem>
  )}
/>
```

#### Screen Reader Support

```typescript
// Loading states
function ExternalAgentList() {
  if (isPending) {
    return (
      <div role="status" aria-live="polite" aria-busy="true">
        <span className="sr-only">Loading external agents...</span>
        <ExternalAgentListSkeleton />
      </div>
    );
  }

  return (
    <div role="region" aria-label="External agents list">
      {/* ... */}
    </div>
  );
}

// Success/error messages
function useCreateExternalAgent() {
  return useMutation({
    onSuccess: () => {
      toast.success("External agent registered successfully!", {
        role: "status",
        "aria-live": "polite",
      });
    },
    onError: (error) => {
      toast.error(`Failed to register agent: ${error.message}`, {
        role: "alert",
        "aria-live": "assertive",
      });
    },
  });
}
```

#### Focus Management

```typescript
// Wizard step transitions
function ExternalAgentWizard() {
  const stepRef = useRef<HTMLDivElement>(null);

  const nextStep = (data: any) => {
    setWizardData({ ...wizardData, ...data });
    setCurrentStep((prev) => Math.min(prev + 1, 6) as WizardStep);

    // Focus on step heading after transition
    setTimeout(() => {
      stepRef.current?.focus();
    }, 100);
  };

  return (
    <div>
      <Stepper currentStep={currentStep} />
      <div
        ref={stepRef}
        tabIndex={-1}
        className="outline-none"
        aria-label={`Step ${currentStep}`}
      >
        {/* Step content */}
      </div>
    </div>
  );
}

// Modal dialogs
function AgentDetailsModal({ agent, isOpen, onClose }) {
  const closeButtonRef = useRef<HTMLButtonElement>(null);

  useEffect(() => {
    if (isOpen) {
      closeButtonRef.current?.focus();
    }
  }, [isOpen]);

  return (
    <Dialog
      open={isOpen}
      onOpenChange={onClose}
      aria-labelledby="agent-details-title"
    >
      <DialogContent>
        <DialogHeader>
          <DialogTitle id="agent-details-title">{agent.name}</DialogTitle>
          <button
            ref={closeButtonRef}
            onClick={onClose}
            aria-label="Close dialog"
          >
            Ã—
          </button>
        </DialogHeader>
        {/* ... */}
      </DialogContent>
    </Dialog>
  );
}
```

---

## Responsive Design

### Breakpoints

```typescript
// Tailwind breakpoints (mobile-first)
const breakpoints = {
  mobile: "375px", // Default (no prefix)
  tablet: "768px", // md: prefix
  desktop: "1024px", // lg: prefix
  wide: "1280px", // xl: prefix
};
```

### Responsive Layouts

```typescript
// Agent List - Mobile: 1 column, Tablet: 2 columns, Desktop: 1 column (wider cards)
function ExternalAgentList() {
  return (
    <div className="grid grid-cols-1 gap-4">
      {/* Single column on all devices, cards adapt width */}
      {agents.map((agent) => (
        <ExternalAgentCard key={agent.id} agent={agent} />
      ))}
    </div>
  );
}

// Agent Card - Responsive internal layout
function ExternalAgentCard({ agent }) {
  return (
    <Card>
      <CardHeader>
        {/* Mobile: Stack vertically, Desktop: Horizontal */}
        <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
          <div className="flex items-center gap-3">
            {/* Icon + Name */}
          </div>
          {/* Mobile: Full-width buttons, Desktop: Inline */}
          <div className="flex flex-col md:flex-row gap-2 w-full md:w-auto">
            <Button className="w-full md:w-auto">View Details</Button>
            <Button className="w-full md:w-auto">Edit</Button>
            <Button className="w-full md:w-auto">Disable</Button>
          </div>
        </div>
      </CardHeader>
    </Card>
  );
}

// Wizard - Mobile: Full-screen modal, Desktop: Large modal
function ExternalAgentWizard() {
  return (
    <Dialog>
      <DialogContent className="w-full h-full md:h-auto md:max-w-3xl p-4 md:p-6">
        <Stepper
          steps={steps}
          currentStep={currentStep}
          className="flex-col md:flex-row"
        />
        {/* ... */}
      </DialogContent>
    </Dialog>
  );
}

// Lineage Viewer - Responsive timeline
function LineageViewer({ invocationId }) {
  return (
    <div className="p-4 md:p-6 max-w-4xl mx-auto">
      {/* Mobile: Compact timeline, Desktop: Expanded */}
      <div className="space-y-2 md:space-y-4">
        {hops.map((hop) => (
          <LineageHop
            key={hop.id}
            hop={hop}
            className="pl-8 md:pl-16" // Smaller indent on mobile
          />
        ))}
      </div>
    </div>
  );
}

// Metrics Charts - Responsive height
function UsageMetricsChart({ agentId }) {
  return (
    <ResponsiveContainer width="100%" height={200} className="md:h-[300px]">
      <LineChart data={data}>
        {/* ... */}
      </LineChart>
    </ResponsiveContainer>
  );
}
```

---

## Implementation Roadmap

### Phase 1: Core Infrastructure (Week 1-2)

**Deliverables**:
- [ ] Set up feature directory structure
- [ ] Create TypeScript types and interfaces
- [ ] Build API client functions
- [ ] Implement Zustand store
- [ ] Create React Query hooks
- [ ] Build basic routing

**Components**:
- [ ] ExternalAgentList (skeleton only)
- [ ] ExternalAgentCard (skeleton only)

### Phase 2: Agent Management (Week 3-4)

**Deliverables**:
- [ ] Complete ExternalAgentList with filtering
- [ ] Complete ExternalAgentCard with actions
- [ ] Build ExternalAgentWizard (all 6 steps)
- [ ] Implement AgentDetailsModal
- [ ] Add InvocationHistory component
- [ ] Platform-specific configuration forms

**Testing**:
- [ ] Unit tests for wizard validation
- [ ] Integration tests for API calls
- [ ] E2E tests for registration flow

### Phase 3: Webhooks Enhancement (Week 5)

**Deliverables**:
- [ ] Enhance existing webhooks page
- [ ] Platform-specific webhook forms (Teams, Discord, Telegram)
- [ ] Test webhook functionality
- [ ] Preview components for webhook messages

**Testing**:
- [ ] Unit tests for webhook validation
- [ ] Integration tests with mock webhook endpoints

### Phase 4: Lineage Viewer (Week 6-7)

**Deliverables**:
- [ ] LineageViewer component with timeline
- [ ] LineageHop component with expand/collapse
- [ ] Identity chain visualization
- [ ] Context details panel
- [ ] Governance checks display
- [ ] Export to JSON functionality

**Testing**:
- [ ] Unit tests for lineage parsing
- [ ] Integration tests for lineage API
- [ ] E2E tests for lineage navigation

### Phase 5: Metrics & Charts (Week 8)

**Deliverables**:
- [ ] UsageMetricsChart component
- [ ] Invocation timeline chart
- [ ] Cost breakdown pie chart
- [ ] Key metrics summary cards
- [ ] Real-time metrics updates

**Testing**:
- [ ] Visual regression tests for charts
- [ ] Integration tests for metrics API

### Phase 6: Polish & Accessibility (Week 9-10)

**Deliverables**:
- [ ] Complete accessibility audit
- [ ] Add ARIA labels to all components
- [ ] Implement keyboard navigation
- [ ] Screen reader testing
- [ ] Responsive design testing (mobile/tablet/desktop)
- [ ] Dark mode support
- [ ] Loading states and error handling
- [ ] Empty states with CTAs

**Testing**:
- [ ] Accessibility testing with axe DevTools
- [ ] Keyboard navigation testing
- [ ] Screen reader testing (NVDA, JAWS)
- [ ] Cross-browser testing (Chrome, Firefox, Safari)
- [ ] Mobile testing (iOS Safari, Chrome Mobile)

### Phase 7: Documentation & Launch (Week 11)

**Deliverables**:
- [ ] Component documentation
- [ ] User guide for external agent registration
- [ ] Developer guide for extending platforms
- [ ] API documentation
- [ ] Release notes

---

## Appendix: Type Definitions

```typescript
// src/features/external-agents/types/externalAgent.ts

export type PlatformType = "copilot" | "azure_openai" | "custom";
export type AgentStatus = "active" | "inactive" | "error";

export interface ExternalAgent {
  id: string;
  name: string;
  description?: string;
  platform: PlatformType;
  status: AgentStatus;
  endpoint_url: string;
  created_at: string;
  updated_at: string;
  last_used_at?: string;
  tags: string[];

  auth_config: ExternalAgentAuthConfig;
  budget: BudgetConfig;
  rate_limits: RateLimitConfig;
  usage: UsageStats;
}

export interface ExternalAgentAuthConfig {
  // GitHub Copilot
  api_key?: string;
  organization_id?: string;

  // Azure OpenAI
  deployment_name?: string;
  api_version?: string;

  // Custom
  auth_type?: "bearer" | "api_key" | "oauth2";
  credentials?: Record<string, string>;
}

export interface BudgetConfig {
  monthly_limit: number;
  alert_threshold: number; // Percentage (0-100)
  alert_email?: string;
}

export interface RateLimitConfig {
  max_per_minute: number;
  max_per_hour: number;
  max_per_day: number;
}

export interface UsageStats {
  total_invocations: number;
  successful_invocations: number;
  failed_invocations: number;
  total_tokens: number;
  cost: number;
  avg_response_time_ms: number;
}

export interface ExternalAgentCreate {
  name: string;
  description?: string;
  platform: PlatformType;
  endpoint_url: string;
  auth_config: ExternalAgentAuthConfig;
  budget: BudgetConfig;
  rate_limits: RateLimitConfig;
  tags?: string[];
}

export interface ExternalAgentUpdate {
  name?: string;
  description?: string;
  status?: AgentStatus;
  auth_config?: Partial<ExternalAgentAuthConfig>;
  budget?: Partial<BudgetConfig>;
  rate_limits?: Partial<RateLimitConfig>;
  tags?: string[];
}

export interface ExternalAgentFilters {
  search?: string;
  platform?: PlatformType | null;
  status?: AgentStatus | "all";
}
```

```typescript
// src/features/external-agents/types/invocation.ts

export interface Invocation {
  id: string;
  agent_id: string;
  agent_name: string;
  timestamp: string;
  caller_identity: string;
  caller_name: string;

  request: {
    prompt: string;
    context?: Record<string, any>;
    max_tokens?: number;
  };

  response?: {
    content: string;
    model?: string;
    finish_reason?: string;
  };

  metrics: InvocationMetrics;
  status: "success" | "error";
  error?: string;
}

export interface InvocationMetrics {
  input_tokens: number;
  output_tokens: number;
  total_tokens: number;
  cost: number;
  latency_ms: number;
}

export interface InvocationLineage {
  invocation_id: string;
  hops: LineageHop[];
  context: LineageContext;
  identity_chain: string[];
  governance: GovernanceChecks;
}

export interface LineageHop {
  id: string;
  timestamp: string;
  title: string;
  caller: string;
  identity: string;
  agent_name?: string;
  endpoint?: string;
  request?: any;
  response?: any;
  metrics?: InvocationMetrics;
  cost?: number;
}

export interface LineageContext {
  session_id: string;
  workspace_id: string;
  user_email: string;
  ip_address: string;
  user_agent: string;
}

export interface GovernanceChecks {
  budget_limit: number;
  cost: number;
  budget_percentage: number;
  rate_limit_current: number;
  rate_limit_max: number;
  scope_used: string;
}

export interface InvocationFilters {
  start_date?: string;
  end_date?: string;
  status?: "success" | "error" | "all";
}
```

```typescript
// src/features/external-agents/types/webhook.ts

export interface WebhookConfig {
  id: string;
  platform: "teams" | "discord" | "telegram" | "generic";
  name: string;
  webhook_url: string;
  enabled: boolean;
  events: WebhookEvent[];
  platform_config: TeamsConfig | DiscordConfig | TelegramConfig | GenericConfig;
  created_at: string;
  updated_at: string;
  last_sent_at?: string;
  last_status?: "success" | "error";
}

export type WebhookEvent =
  | "agent_invocation"
  | "deployment"
  | "error"
  | "budget_alert"
  | "audit";

export interface TeamsConfig {
  message_template: "adaptive_card" | "simple_text";
  card_theme_color: "default" | "good" | "warning" | "attention";
}

export interface DiscordConfig {
  username?: string;
  avatar_url?: string;
  embed_color: string; // Hex color
  use_embeds: boolean;
}

export interface TelegramConfig {
  bot_token: string;
  chat_id: string;
  parse_mode: "Markdown" | "HTML" | "MarkdownV2";
  disable_notification?: boolean;
}

export interface GenericConfig {
  headers?: Record<string, string>;
  auth_type?: "none" | "bearer" | "basic";
  auth_token?: string;
}
```

---

## Summary

This document provides a comprehensive blueprint for implementing External Integrations UI in Kaizen Studio with:

1. **3 Main Pages**: External Agents, Enhanced Webhooks, Lineage Viewer
2. **6-Step Registration Wizard**: Guided agent setup with real-time validation
3. **Platform-Specific Forms**: Tailored configs for Copilot, Azure OpenAI, Custom
4. **Visual Lineage Tracing**: Timeline-based invocation chain visualization
5. **Real-Time Metrics**: Charts and dashboards for usage monitoring
6. **Accessibility-First**: WCAG 2.1 AA compliance from day 1
7. **Responsive Design**: Mobile (375px), Tablet (768px), Desktop (1024px+)
8. **11-Week Roadmap**: Phased implementation with clear milestones

All components follow Kaizen Studio's design system, use shadcn/ui primitives, and integrate with existing state management (Zustand + React Query).
